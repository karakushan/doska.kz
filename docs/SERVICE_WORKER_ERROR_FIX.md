# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ Service Worker

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:
```
token-manager.ts:102 Uncaught (in promise) TypeError: Cannot read properties of undefined (reading 'pushManager')
```

## üîç –ü—Ä–∏—á–∏–Ω–∞:
–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∫–æ–≥–¥–∞ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Service Worker –∏–ª–∏ `navigator.serviceWorker` –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω. Firebase –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `pushManager` —á–µ—Ä–µ–∑ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Service Worker.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ:

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Service Worker**

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Service Worker
if (!('serviceWorker' in navigator)) {
    return Promise.resolve(null);
}
```

### 2. **–î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞**

```javascript
function getToken() {
    if (!messaging) return;
    
    // Check if Service Worker is supported
    if (!('serviceWorker' in navigator)) {
        // Fallback: get token without service worker
        messaging.getToken({ vapidKey: firebaseConfig.vapidKey })
            .then(function(token) {
                if (token) {
                    saveTokenToServer(token);
                }
            })
            .catch(function(err) {
                // Error retrieving token
            });
        return;
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å Service Worker
}
```

### 3. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

```javascript
// –î–æ–±–∞–≤–ª–µ–Ω—ã catch –±–ª–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö Promise –æ–ø–µ—Ä–∞—Ü–∏–π
.catch(function(error) {
    // Graceful error handling
    return null;
});
```

### 4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
if (!('Notification' in window)) {
    return;
}
```

## üéØ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### **–§—É–Ω–∫—Ü–∏—è `getToken()`:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Service Worker
- ‚úÖ Fallback –±–µ–∑ Service Worker
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### **–§—É–Ω–∫—Ü–∏—è `initializeServiceWorker()`:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Service Worker
- ‚úÖ Graceful fallback
- ‚úÖ –£–±—Ä–∞–Ω—ã console.log

### **–§—É–Ω–∫—Ü–∏—è `getServiceWorkerRegistration()`:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Service Worker
- ‚úÖ –í–æ–∑–≤—Ä–∞—Ç null –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏

### **–§—É–Ω–∫—Ü–∏—è `requestPermission()`:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç:

- **–ù–µ—Ç –æ—à–∏–±–æ–∫** –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Service Worker
- **–†–∞–±–æ—Ç–∞–µ—Ç** –≤ —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö (fallback —Ä–µ–∂–∏–º)
- **Graceful degradation** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ Service Worker
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –Ω–µ—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö Promise –æ—à–∏–±–æ–∫

## üì± –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã:

### **–° –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:**
- Chrome 50+
- Firefox 44+
- Safari 11.1+
- Edge 17+

### **–° fallback –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:**
- Internet Explorer 11
- –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–æ–≤
- –ë—Ä–∞—É–∑–µ—Ä—ã –±–µ–∑ Service Worker

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å** - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫
3. **–†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è FCM —Ç–æ–∫–µ–Ω
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É** –≤ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤–æ –≤—Å–µ—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö, –≤–∫–ª—é—á–∞—è —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç Service Worker! üöÄ

