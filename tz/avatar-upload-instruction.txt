ИНСТРУКЦИЯ: ПОЛЕ ЗАГРУЗКИ АВАТАРА В ELEMENTOR

════════════════════════════════════════════════════════════════

📋 ЧТО БЫЛО СОЗДАНО:

1. Виджет Elementor "Avatar Upload"
2. Обработчик загрузки аватара при регистрации
3. Автоматическая установка фото как аватара WordPress
4. Превью изображения перед отправкой формы
5. Валидация файлов (тип и размер)

════════════════════════════════════════════════════════════════

🔧 СОЗДАННЫЕ ФАЙЛЫ:

Тема Classiadspro (БЕЗ МОДИФИКАЦИИ ПЛАГИНОВ):
- /wordpress/wp-content/themes/classiadspro/includes/elementor-avatar-field.php
- /wordpress/wp-content/themes/classiadspro/custom.css (обновлен)
- /wordpress/wp-content/themes/classiadspro/custom.js (обновлен)
- /wordpress/wp-content/themes/classiadspro/functions.php (обновлен)

✅ НИ ОДИН ФАЙЛ ПЛАГИНА НЕ МОДИФИЦИРОВАН!
✅ ВСЕ ФУНКЦИИ РЕАЛИЗОВАНЫ ЧЕРЕЗ ХУКИ WORDPRESS!
✅ ПЛАГИН МОЖНО ОБНОВЛЯТЬ БЕЗ ПОТЕРИ ФУНКЦИОНАЛА!

════════════════════════════════════════════════════════════════

📖 КАК ИСПОЛЬЗОВАТЬ:

1. В админ-панели WordPress:
   - Перейдите в раздел с формами (Form Builder WP)
   - Откройте форму регистрации в Elementor

2. В редакторе Elementor:
   - В левой панели найдите виджеты Form Builder WP
   - В категории "Form fields" найдите виджет "Avatar Upload"
   - Перетащите виджет в нужное место формы

3. Настройка виджета:
   - Label: название поля (по умолчанию "Profile Photo")
   - Name: обязательно должно быть "user_avatar"
   - Help text: подсказка для пользователя
   - Required: обязательное поле или нет
   - Attributes: по умолчанию accept="image/jpeg,image/png,image/gif"

4. Сохраните форму

════════════════════════════════════════════════════════════════

✅ ФУНКЦИОНАЛ:

На фронтенде:
- Пользователь видит кнопку "Choose Photo"
- При выборе фото показывается превью изображения
- Валидация формата (только JPG, PNG, GIF)
- Валидация размера (максимум 2MB)
- После регистрации фото автоматически загружается

После регистрации:
- Фото загружается в медиабиблиотеку WordPress
- Устанавливается как аватар пользователя
- Отображается во всех местах где используется get_avatar()

════════════════════════════════════════════════════════════════

🎨 СТИЛИЗАЦИЯ:

Все стили находятся в:
/wordpress/wp-content/themes/classiadspro/custom.css

Классы для кастомизации:
- .wpfb_form_avatar - контейнер поля
- .wpfb-avatar-upload-wrapper - обертка для input
- .wpfb-avatar-preview - превью изображения
- .wpfb-form-file-button - кнопка выбора файла

════════════════════════════════════════════════════════════════

⚙️ ТЕХНИЧЕСКИЕ ДЕТАЛИ:

Хуки и фильтры:
- wpfb_form_fields - добавление виджета в список
- wpfb_form_validate_file - валидация загружаемого файла
- wpfb_form_register_new_user_success - обработка после регистрации
- get_avatar - замена стандартного аватара на загруженный

Мета-поля пользователя:
- user_avatar - ID вложения в медиабиблиотеке
- user_avatar_url - URL загруженного изображения
- wp_user_avatar - для совместимости с плагинами
- simple_local_avatar - для совместимости с плагинами

════════════════════════════════════════════════════════════════

🔍 ПРОВЕРКА РАБОТЫ:

ШАГ 1: ОЧИСТКА КЕША
--------------------
1. Откройте в браузере: http://ваш-домен/clear-elementor-cache.php
2. Этот файл автоматически очистит кеш и проверит регистрацию виджета
3. Убедитесь что видите: "✓ Avatar Upload widget IS registered!"
4. Если виджет не зарегистрирован - сообщите об ошибке

ШАГ 2: ДОПОЛНИТЕЛЬНАЯ ОЧИСТКА (если виджет все еще не виден)
------------------------------------------------------------
1. В админ-панели: Elementor → Tools → Regenerate CSS & Data → Нажмите "Regenerate Files & Data"
2. Очистите кеш браузера (Ctrl+Shift+Delete)
3. Перезагрузите страницу редактора Elementor

ШАГ 3: ПРОВЕРКА В ELEMENTOR
---------------------------
1. Откройте форму регистрации в редакторе Elementor
2. В левой панели виджетов найдите категорию "Form fields"
3. Прокрутите вниз - виджет "Avatar Upload" должен быть в списке
4. Если виджета нет - проверьте консоль браузера на наличие JavaScript ошибок

ШАГ 4: ДОБАВЛЕНИЕ В ФОРМУ
-------------------------
1. Перетащите виджет "Avatar Upload" в форму
2. Установите Name: "user_avatar" (обязательно!)
3. Настройте остальные параметры по желанию
4. Сохраните форму

ШАГ 5: ТЕСТИРОВАНИЕ НА ФРОНТЕНДЕ
---------------------------------
1. Откройте форму регистрации на сайте
2. Выберите фото для загрузки
3. Должно появиться превью изображения
4. Зарегистрируйте тестового пользователя
5. Проверьте что аватар отображается в профиле

ШАГ 6: УДАЛЕНИЕ ВРЕМЕННОГО ФАЙЛА
--------------------------------
После успешной проверки удалите файл:
/wordpress/clear-elementor-cache.php

════════════════════════════════════════════════════════════════

💡 ВАЖНО:

- Имя поля ОБЯЗАТЕЛЬНО должно быть "user_avatar"
- Максимальный размер файла: 2MB
- Поддерживаемые форматы: JPG, PNG, GIF
- Все файлы плагина могут быть перезаписаны при обновлении плагина
- Рекомендуется создать бэкап перед обновлением Form Builder WP

════════════════════════════════════════════════════════════════

Дата создания: 25.10.2025

